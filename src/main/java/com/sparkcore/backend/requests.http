### ============================================================
### SparkCore Backend – API Test Requests
### ============================================================
###
### ANLEITUNG:
### 1. Umgebung starten: docker-compose up -d
### 2. App starten: ./mvnw spring-boot:run
### 3. Request "Step 1: Admin Login" ausführen
### 4. Den Token aus der Antwort kopieren und hier unter @admin_token eintragen!
### ============================================================

@baseUrl = http://localhost:8080/api/v1
@admin_token = eyJhbGciOiJIUzM4NCJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc3MjMyNTQyOSwiZXhwIjoxNzcyNDExODI5fQ.vq5XOPRfFo8vy6x-4YdzFOKNacBlP4_h0dzzOu93Pi4AOO4k65g_lUIe1Q5bkmb1
@user_token = eyJhbGciOiJIUzM4NCJ9.eyJzdWIiOiJtYXhfbXVzdGVyIiwiaWF0IjoxNzcyMzI1NDY5LCJleHAiOjE3NzI0MTE4Njl9.Cih4MMmWkFwnfKmS_LSHBd1oTqqfC5TIuohumek62RRHDM6v0lXQKA0jh-a-G1bb

### ============================================================
### 1. SYSTEM & AUTHENTICATION
### ============================================================

### Ping – Öffentlich (kein Token nötig)
GET {{baseUrl}}/system/ping

### Step 1: Admin Login → Generiert Token für @admin_token
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "super_secret"
}

### Step 2: Neuen User registrieren (kein Token nötig)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "username": "max_muster",
  "password": "geheimesPasswort123"
}

### Step 3: User Login → Generiert Token für @user_token
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "max_muster",
  "password": "geheimesPasswort123"
}


### ============================================================
### 2. ACCOUNT MANAGEMENT (Erfordert Token)
### ============================================================

### Step 4: Erstes Konto erstellen (Admin-Token erforderlich)
POST {{baseUrl}}/accounts
Content-Type: application/json
Authorization: Bearer {{admin_token}}

{
  "ownerName": "Max Mustermann",
  "iban": "DE12345678901234567890",
  "initialBalance": 1000.50
}

### Step 5: Zweites Konto erstellen (Admin-Token erforderlich)
POST {{baseUrl}}/accounts
Content-Type: application/json
Authorization: Bearer {{admin_token}}

{
  "ownerName": "Lisa Müller",
  "iban": "DE09876543210987654321",
  "initialBalance": 500.00
}

### Step 6: Alle Konten abrufen (Admin-Token erforderlich)
GET {{baseUrl}}/accounts
Authorization: Bearer {{admin_token}}


### ============================================================
### 3. TRANSACTIONS & AUDIT (Erfordert Token)
### ============================================================

### Step 7: Überweisung – Max → Lisa (150.50 EUR)
POST {{baseUrl}}/accounts/transfer
Content-Type: application/json
Authorization: Bearer {{user_token}}

{
  "fromIban": "DE12345678901234567890",
  "toIban": "DE09876543210987654321",
  "amount": 150.50
}

### Step 8: Kontoauszug für Max – alle Transaktionen
GET {{baseUrl}}/accounts/DE12345678901234567890/transactions
Authorization: Bearer {{user_token}}


### Step 9: Alle Audit-Logs abrufen (Admin-Token erforderlich)
GET {{baseUrl}}/audit-logs
Authorization: Bearer {{admin_token}}


### ============================================================
### 4. SECURITY TESTS (Redis Rate Limiting)
### ============================================================

### Step 10: Redis Rate Limiting Test (Brute Force Simulation)
### ANLEITUNG: Klicke 6 mal extrem schnell hintereinander auf diesen Request.
### Die ersten 5 werden "401 Unauthorized" zurückgeben (falsches Passwort).
### Der 6. Request MUSS "429 Too Many Requests" zurückgeben!
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "wrong_password_to_test_limit"
}
